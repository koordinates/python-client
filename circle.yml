machine:
  python:
    version: 2.7.11

dependencies:
  pre:
    - pyenv install -s 3.5.4
    - pyenv install -s 3.6.4
    - pyenv global 2.7.11 3.5.4 3.6.4
    - pip install -r requirements-dev.txt

  post:
    - make docs
    - mv docs/build ${CIRCLE_ARTIFACTS}/docs
    - cd ${CIRCLE_ARTIFACTS}; zip -r docs.zip docs

test:
  pre:
    - mkdir -p ${CIRCLE_TEST_REPORTS}/junit ${CIRCLE_ARTIFACTS}/coverage
  override:
    - tox --
      --verbose
      -p no:sugar
      --cov=koordinates
      --cov-report html:${CIRCLE_ARTIFACTS}/coverage/
      tests/
  post:
    - cp pytest.*.xml ${CIRCLE_TEST_REPORTS}/junit/
